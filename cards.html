<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí≥ –ö–∞—Ä—Ç—ã - IP Expense Manager</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- –§–ê–í–ò–ö–û–ù -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'><defs><linearGradient id='borderGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%238b5cf6'/><stop offset='50%' stop-color='%236d28d9'/><stop offset='100%' stop-color='%231e40af'/></linearGradient><linearGradient id='checkGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%23a78bfa'/><stop offset='100%' stop-color='%234f46e5'/></linearGradient><filter id='glow' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceGraphic' stdDeviation='1' result='blur'/><feMerge><feMergeNode in='blur'/><feMergeNode in='SourceGraphic'/></feMerge></filter></defs><circle cx='10' cy='10' r='9' fill='none' stroke='url(%23borderGrad)' stroke-width='1.5' opacity='0.9'/><path d='M6,10 L8.5,12.5 L14,7' stroke='url(%23checkGrad)' stroke-width='2.5' fill='none' stroke-linecap='round' stroke-linejoin='round' filter='url(%23glow)'/></svg>">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <a href="dashboard.html" class="navbar-brand">
                    üéØ IP Expense Manager
                </a>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <span style="color: white; font-size: 14px;" id="userInfo">
                        <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                    </span>
                    <button onclick="Auth.logout()" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); font-size: 14px;">
                        üö™ –í—ã–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container" style="padding: 40px 20px;">
        <div class="glass-card animate-slide-in">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;">
                <div>
                    <h1 style="margin-bottom: 8px; color: var(--primary);">üí≥ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã</h1>
                    <p style="color: var(--text-light); margin: 0;">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ –∫–∞—Ä—Ç–∞–º–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º –∏ –ò–ü</p>
                </div>
                <button class="btn btn-primary" id="addButton" style="display: none;" onclick="showAddCardForm()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É</button>
            </div>

            <!-- –ö–û–ú–ü–ê–ö–¢–ù–´–ï –§–ò–õ–¨–¢–†–´ -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px;">
                <div class="form-group">
                    <label class="form-label" style="font-size: 0.9rem; margin-bottom: 6px;">üìç –†–µ–≥–∏–æ–Ω</label>
                    <select class="form-control form-select" id="regionFilter" onchange="filterCards()" style="padding: 10px 12px; font-size: 0.9rem;">
                        <option value="">–í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" style="font-size: 0.9rem; margin-bottom: 6px;">üîç –ü–æ–∏—Å–∫</label>
                    <input type="text" class="form-control" id="searchInput" placeholder="–ò–ü –∏–ª–∏ –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã..." onkeyup="filterCards()" style="padding: 10px 12px; font-size: 0.9rem;">
                </div>
            </div>

            <!-- –ö–û–ú–ü–ê–ö–¢–ù–´–ô –ö–û–ù–¢–ï–ô–ù–ï–† –ö–ê–†–¢ -->
            <div id="cardsContainer">
                <div style="text-align: center; color: var(--text-light); padding: 40px;">
                    <div style="font-size: 3rem; margin-bottom: 16px;">üí≥</div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç...</p>
                </div>
            </div>
        </div>

        <!-- –§–û–†–ú–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø/–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø -->
        <div class="glass-card animate-fade-in" id="cardForm" style="padding: 24px; margin-top: 24px; display: none;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                <h3 style="color: var(--primary); margin: 0;" id="formTitle">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É</h3>
                <button type="button" class="btn btn-outline" style="padding: 8px 12px;" onclick="hideCardForm()">‚úï</button>
            </div>
            
            <form id="cardFormElement">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">üèôÔ∏è –†–µ–≥–∏–æ–Ω *</label>
                        <select class="form-control form-select" id="cardRegion" required onchange="onCardRegionChange()">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω...</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üíº –ò–ü *</label>
                        <select class="form-control form-select" id="cardIP" required disabled>
                            <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω</option>
                        </select>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 20px;">
                    <div class="form-group">
                        <label class="form-label">üí≥ –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞</label>
                        <input type="text" class="form-control" id="corpCard" 
                               placeholder="*1234" maxlength="5" style="font-family: monospace;">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">üë§ –ö–∞—Ä—Ç–∞ –§–õ</label>
                        <input type="text" class="form-control" id="flCard" 
                               placeholder="*5678" maxlength="5" style="font-family: monospace;">
                    </div>
                </div>
                
                <div class="form-group" style="margin-bottom: 20px;">
                    <label class="form-label">üìç –°—Ç–∞—Ç—É—Å –∫–∞—Ä—Ç—ã *</label>
                    <select class="form-control form-select" id="cardStatus" required>
                        <option value="–≤ —Ä–µ–≥–∏–æ–Ω–µ">‚úÖ –í —Ä–µ–≥–∏–æ–Ω–µ</option>
                        <option value="–í –ü–í–ó">üì¶ –í –ü–í–ó</option>
                        <option value="–ü–µ—Ä–µ–≤—ã–ø—É—Å—Ç–∏—Ç—å">üîÑ –ü–µ—Ä–µ–≤—ã–ø—É—Å—Ç–∏—Ç—å</option>
                        <option value="–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞">üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞</option>
                    </select>
                </div>
                
                <div style="display: flex; gap: 12px; justify-content: flex-end;">
                    <button type="button" class="btn btn-outline" onclick="hideCardForm()">
                        ‚ùå –û—Ç–º–µ–Ω–∞
                    </button>
                    <button type="submit" class="btn btn-primary" id="submitButton">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </div>
            </form>
        </div>
    </main>

    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script>
        let editingCardIP = null;
        let allCardsData = {};

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üí≥ –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ä—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            Auth.init();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            if (!Auth.requireAuth()) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            updateUserInfo();
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ —Ä–æ–ª—è–º
            setupRoleBasedUI();
            
            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã
            populateFilters();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ä—Ç—ã
            loadCards();
        });

        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            if (userInfo && Auth.currentUser) {
                userInfo.innerHTML = `üëã ${Auth.currentUser.name} 
                    <span style="opacity: 0.8;">(${Auth.currentUser.role === 'admin' ? '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä' : '–£–ø—Ä–∞–≤–ª—è—é—â–∏–π'})</span>`;
            }
        }

        function setupRoleBasedUI() {
            const addButton = document.getElementById('addButton');
            if (addButton) {
                addButton.style.display = Auth.isAdmin() ? 'block' : 'none';
            }
        }

        function populateFilters() {
            const regionFilter = document.getElementById('regionFilter');
            const cardRegion = document.getElementById('cardRegion');
            
            appData.regions.forEach(region => {
                // –î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞
                const filterOption = document.createElement('option');
                filterOption.value = region;
                filterOption.textContent = region;
                regionFilter.appendChild(filterOption);
                
                // –î–ª—è —Ñ–æ—Ä–º—ã
                const formOption = document.createElement('option');
                formOption.value = region;
                formOption.textContent = region;
                cardRegion.appendChild(formOption);
            });
        }

       // –í cards.html –ù–ê–ô–¢–ò —Ñ—É–Ω–∫—Ü–∏—é loadCards() –∏ –ó–ê–ú–ï–ù–ò–¢–¨ –Ω–∞:

function loadCards() {
    const container = document.getElementById('cardsContainer');
    const regionFilter = document.getElementById('regionFilter').value;
    const searchQuery = document.getElementById('searchInput').value.toLowerCase();
    
    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç
    allCardsData = {};
    let hasCards = false;
    
    appData.regions.forEach(region => {
        // ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
        if (regionFilter && regionFilter !== '' && regionFilter !== region) return;
        
        const regionIPs = appData.individualEntrepreneurs[region];
        let regionCards = [];
        
        regionIPs.forEach(ip => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–∏—Å–∫ –ø–æ –ò–ü
            if (searchQuery && !ip.toLowerCase().includes(searchQuery)) return;
            
            const cards = appData.bankCards[ip];
            if (!cards) return;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É –∫–∞—Ä—Ç—ã
            const hasMatchingCard = searchQuery && (
                (cards.corpCard && cards.corpCard.toLowerCase().includes(searchQuery)) ||
                (cards.flCard && cards.flCard.toLowerCase().includes(searchQuery))
            );
            
            if (searchQuery && !hasMatchingCard && !ip.toLowerCase().includes(searchQuery)) return;
            
            regionCards.push({
                ip: ip,
                region: region,
                corpCard: cards.corpCard,
                flCard: cards.flCard,
                status: cards.status
            });
            
            hasCards = true;
        });
        
        if (regionCards.length > 0) {
            allCardsData[region] = regionCards;
        }
    });
    
    displayCards(allCardsData, hasCards);
}

        function displayCards(cardsData, hasCards) {
            const container = document.getElementById('cardsContainer');
            
            if (!hasCards) {
                container.innerHTML = `
                    <div style="text-align: center; color: var(--text-light); padding: 40px;">
                        <div style="font-size: 3rem; margin-bottom: 16px;">üí≥</div>
                        <h3 style="margin-bottom: 8px;">–ö–∞—Ä—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
                        ${Auth.isAdmin() ? 
                            '<button class="btn btn-primary" style="margin-top: 16px;" onclick="showAddCardForm()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é –∫–∞—Ä—Ç—É</button>' : 
                            ''
                        }
                    </div>
                `;
                return;
            }
            
            let cardsHtml = '';
            
            Object.entries(cardsData).forEach(([region, cards]) => {
                cardsHtml += `
                    <div style="margin-bottom: 24px;">
                        <h2 style="margin-bottom: 16px; padding-bottom: 8px; border-bottom: 2px solid var(--primary); font-size: 1.25rem;">
                            üèôÔ∏è ${region}
                        </h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px;">
                `;
                
                cards.forEach(card => {
                    cardsHtml += `
                        <div class="glass-card" style="padding: 16px; transition: var(--transition);">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                                <div style="flex: 1;">
                                    <h3 style="margin-bottom: 4px; color: var(--primary); font-size: 1rem;">${card.ip}</h3>
                                    <div style="color: var(--text-light); font-size: 0.8rem; margin-bottom: 8px;">${card.region}</div>
                                </div>
                                ${Auth.isAdmin() ? `
                                <div style="display: flex; gap: 4px; margin-left: 12px;">
                                    <button class="btn btn-outline" style="padding: 6px 8px; font-size: 0.8rem;" 
                                            onclick="editCard('${card.ip}')">
                                        ‚úèÔ∏è
                                    </button>
                                    <button class="btn btn-outline" style="padding: 6px 8px; font-size: 0.8rem; background: rgba(239, 68, 68, 0.1); color: var(--error);" 
                                            onclick="deleteCard('${card.ip}')">
                                        üóëÔ∏è
                                    </button>
                                </div>
                                ` : ''}
                            </div>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px;">
                                ${card.corpCard ? `
                                    <div>
                                        <div style="font-weight: 600; color: var(--success); margin-bottom: 2px; font-size: 0.8rem;">üí≥ –ö–æ—Ä–ø.</div>
                                        <div style="font-family: monospace; font-size: 0.9rem; color: var(--text-dark);">${card.corpCard}</div>
                                    </div>
                                ` : '<div></div>'}
                                
                                ${card.flCard ? `
                                    <div>
                                        <div style="font-weight: 600; color: var(--warning); margin-bottom: 2px; font-size: 0.8rem;">üë§ –§–õ</div>
                                        <div style="font-family: monospace; font-size: 0.9rem; color: var(--text-dark);">${card.flCard}</div>
                                    </div>
                                ` : '<div></div>'}
                            </div>
                            
                            <div>
                                <span class="badge ${getStatusBadgeClass(card.status)}" style="font-size: 0.75rem;">
                                    ${card.status}
                                </span>
                            </div>
                        </div>
                    `;
                });
                
                cardsHtml += `
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = cardsHtml;
        }

        function getStatusBadgeClass(status) {
            switch (status) {
                case '–≤ —Ä–µ–≥–∏–æ–Ω–µ': return 'badge-success';
                case '–í –ü–í–ó': return 'badge-warning';
                case '–ü–µ—Ä–µ–≤—ã–ø—É—Å—Ç–∏—Ç—å': return 'badge-error';
                case '–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞': return 'badge-error';
                default: return 'badge-info';
            }
        }

        function filterCards() {
            loadCards();
        }

        function onCardRegionChange() {
            const region = document.getElementById('cardRegion').value;
            const ipSelect = document.getElementById('cardIP');
            
            if (region) {
                const ips = appData.getIPsByRegion(region);
                ipSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ò–ü...</option>';
                ips.forEach(ip => {
                    const option = document.createElement('option');
                    option.value = ip;
                    option.textContent = ip;
                    ipSelect.appendChild(option);
                });
                ipSelect.disabled = false;
            } else {
                ipSelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–≥–∏–æ–Ω</option>';
                ipSelect.disabled = true;
            }
        }

        function showAddCardForm() {
            if (!Auth.isAdmin()) {
                Notification.error('–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º');
                return;
            }
            
            document.getElementById('cardForm').style.display = 'block';
            document.getElementById('formTitle').textContent = '‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É';
            document.getElementById('submitButton').textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
            editingCardIP = null;
            document.getElementById('cardFormElement').reset();
            document.getElementById('cardIP').disabled = false;
        }

        function hideCardForm() {
            document.getElementById('cardForm').style.display = 'none';
            editingCardIP = null;
        }

        function editCard(ip) {
            if (!Auth.isAdmin()) {
                Notification.error('–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º');
                return;
            }
            
            const cards = appData.bankCards[ip];
            if (!cards) {
                Notification.error('–ö–∞—Ä—Ç—ã –¥–ª—è —ç—Ç–æ–≥–æ –ò–ü –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                return;
            }
            
            // –ù–∞—Ö–æ–¥–∏–º —Ä–µ–≥–∏–æ–Ω –ò–ü
            let region = '';
            for (const [reg, ips] of Object.entries(appData.individualEntrepreneurs)) {
                if (ips.includes(ip)) {
                    region = reg;
                    break;
                }
            }
            
            document.getElementById('cardForm').style.display = 'block';
            document.getElementById('formTitle').textContent = `‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç—ã: ${ip}`;
            document.getElementById('submitButton').textContent = 'üíæ –û–±–Ω–æ–≤–∏—Ç—å';
            
            document.getElementById('cardRegion').value = region;
            onCardRegionChange();
            
            // –ñ–¥–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –ò–ü
            setTimeout(() => {
                document.getElementById('cardIP').value = ip;
                document.getElementById('cardIP').disabled = true; // –ù–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –ò–ü –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
            }, 100);
            
            document.getElementById('corpCard').value = cards.corpCard || '';
            document.getElementById('flCard').value = cards.flCard || '';
            document.getElementById('cardStatus').value = cards.status || '–≤ —Ä–µ–≥–∏–æ–Ω–µ';
            
            editingCardIP = ip;
        }

        function deleteCard(ip) {
            if (!Auth.isAdmin()) {
                Notification.error('–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º');
                return;
            }
            
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç—ã –¥–ª—è –ò–ü "${ip}"?`)) {
                delete appData.bankCards[ip];
                Notification.success(`üóëÔ∏è –ö–∞—Ä—Ç—ã –¥–ª—è "${ip}" —É–¥–∞–ª–µ–Ω—ã`);
                loadCards();
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∫–∞—Ä—Ç—ã
        document.getElementById('cardFormElement').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!Auth.isAdmin()) {
                Notification.error('–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º');
                return;
            }
            
            const formData = {
                region: document.getElementById('cardRegion').value,
                ip: document.getElementById('cardIP').value,
                corpCard: document.getElementById('corpCard').value.trim(),
                flCard: document.getElementById('flCard').value.trim(),
                status: document.getElementById('cardStatus').value
            };
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!formData.region || !formData.ip || !formData.status) {
                Notification.error('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                return;
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ –∫–∞—Ä—Ç
            if (formData.corpCard && !formData.corpCard.startsWith('*')) {
                formData.corpCard = '*' + formData.corpCard;
            }
            if (formData.flCard && !formData.flCard.startsWith('*')) {
                formData.flCard = '*' + formData.flCard;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —É–∫–∞–∑–∞–Ω–∞ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –∫–∞—Ä—Ç–∞
            if (!formData.corpCard && !formData.flCard) {
                Notification.error('‚ùå –£–∫–∞–∂–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –∫–∞—Ä—Ç—É (–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—É—é –∏–ª–∏ –§–õ)');
                return;
            }
            
            if (editingCardIP === null) {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç—ã
                appData.bankCards[formData.ip] = {
                    corpCard: formData.corpCard || '',
                    flCard: formData.flCard || '',
                    status: formData.status
                };
                Notification.success(`‚úÖ –ö–∞—Ä—Ç—ã –¥–ª—è "${formData.ip}" –¥–æ–±–∞–≤–ª–µ–Ω—ã`);
            } else {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π
                appData.bankCards[editingCardIP] = {
                    corpCard: formData.corpCard || '',
                    flCard: formData.flCard || '',
                    status: formData.status
                };
                Notification.success(`‚úÖ –ö–∞—Ä—Ç—ã –¥–ª—è "${editingCardIP}" –æ–±–Ω–æ–≤–ª–µ–Ω—ã`);
            }
            
            hideCardForm();
            loadCards();
        });
    </script>
</body>
</html>