<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ - IP Expense Manager</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/analytics.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <a href="dashboard.html" class="navbar-brand">
                    üéØ IP Expense Manager
                </a>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <span style="color: white; font-size: 14px;" id="userInfo">
                        <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                    </span>
                    <button onclick="Auth.logout()" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); font-size: 14px;">
                        üö™ –í—ã–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container" style="padding: 40px 20px;">
        <div class="glass-card" style="padding: 30px; margin-bottom: 30px;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 16px;">
                <div>
                    <h1 style="margin-bottom: 8px; color: var(--primary);">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á–µ—Ç—ã</h1>
                    <p style="color: var(--text-light); margin: 0;">–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</p>
                </div>
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <button class="btn btn-outline" onclick="Analytics.refreshData()">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                    <div class="dropdown">
                        <button class="btn btn-primary">
                            üìÑ –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞
                        </button>
                        <div class="dropdown-content">
                            <a href="#" onclick="Analytics.exportReport('csv')">üìä CSV</a>
                            <a href="#" onclick="Analytics.exportReport('pdf')">üìÑ PDF</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value" id="kpiTotalTasks">0</div>
                    <div class="metric-label">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="kpiCompletedTasks">0</div>
                    <div class="metric-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞—á</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="kpiCompletionRate">0%</div>
                    <div class="metric-label">–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="kpiAvgCompletionTime">0 –¥–Ω.</div>
                    <div class="metric-label">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                </div>
            </div>
        </div>

        <div class="analytics-grid">
            <div class="chart-card analytics-card">
                <div class="chart-header">
                    <h3 class="chart-title">üí∞ –†–∞—Å—Ö–æ–¥—ã –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º</h3>
                </div>
                <div class="chart-container">
                    <canvas id="expensesByRegionChart"></canvas>
                </div>
            </div>

            <div class="chart-card analytics-card">
                <div class="chart-header">
                    <h3 class="chart-title">üë• –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö</h3>
                </div>
                <div class="chart-container">
                    <canvas id="managerPerformanceChart"></canvas>
                </div>
            </div>

            <div class="chart-card analytics-card">
                <div class="chart-header">
                    <h3 class="chart-title">üéØ –°—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á</h3>
                </div>
                <div class="chart-container">
                    <canvas id="taskStatusChart"></canvas>
                </div>
            </div>

            <div class="chart-card analytics-card">
                <div class="chart-header">
                    <h3 class="chart-title">üìä –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–æ–≤</h3>
                </div>
                <div class="chart-container">
                    <canvas id="expenseDistributionChart"></canvas>
                </div>
            </div>

            <div class="chart-card analytics-card-wide">
                <div class="chart-header">
                    <h3 class="chart-title">üí≥ –ü–ª–∞–Ω vs –§–∞–∫—Ç (–µ–∂–µ–º–µ—Å—è—á–Ω–æ)</h3>
                </div>
                <div class="chart-container">
                    <canvas id="planVsActualChart"></canvas>
                </div>
            </div>

            <div class="chart-card analytics-card-wide">
                <div class="chart-header">
                    <h3 class="chart-title">üìà –¢—Ä–µ–Ω–¥—ã –ø–æ –º–µ—Å—è—Ü–∞–º</h3>
                </div>
                <div class="chart-container">
                    <canvas id="monthlyTrendsChart"></canvas>
                </div>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">üìä –î–µ—Ç–∞–ª—å–Ω–∞—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö</h3>
            </div>
            <div style="overflow-x: auto;">
                <table class="report-table">
                    <thead>
                        <tr>
                            <th>–£–ø—Ä–∞–≤–ª—è—é—â–∏–π</th>
                            <th>–í—Å–µ–≥–æ –∑–∞–¥–∞—á</th>
                            <th>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</th>
                            <th>–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
                            <th>–°—Ä–µ–¥–Ω—è—è —Å—É–º–º–∞</th>
                            <th>–†–µ–≥–∏–æ–Ω—ã</th>
                        </tr>
                    </thead>
                    <tbody id="managerPerformanceTable">
                        <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/analytics.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìä –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            Auth.init();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            if (!Auth.requireAuth()) return;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            updateUserInfo();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–Ω–∞–ª–∏—Ç–∏–∫—É
            Analytics.init();
        });

        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            if (userInfo && Auth.currentUser) {
                userInfo.innerHTML = `üëã ${Auth.currentUser.name} 
                    <span style="opacity: 0.8;">(${Auth.currentUser.role === 'admin' ? '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä' : '–£–ø—Ä–∞–≤–ª—è—é—â–∏–π'})</span>`;
            }
        }

        // –°—Ç–∏–ª–∏ –¥–ª—è dropdown
        const style = document.createElement('style');
        style.textContent = `
            .dropdown {
                position: relative;
                display: inline-block;
            }
            .dropdown-content {
                display: none;
                position: absolute;
                background: white;
                min-width: 160px;
                box-shadow: var(--shadow-lg);
                border-radius: 8px;
                z-index: 1;
                margin-top: 4px;
            }
            .dropdown-content a {
                color: var(--text-dark);
                padding: 12px 16px;
                text-decoration: none;
                display: block;
                border-radius: 8px;
                transition: var(--transition);
            }
            .dropdown-content a:hover {
                background: var(--bg-light);
            }
            .dropdown:hover .dropdown-content {
                display: block;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>