<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä –î–∞—à–±–æ—Ä–¥ - IP Expense Manager</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/dashboard.css">
    <!-- –§–ê–í–ò–ö–û–ù -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'><defs><linearGradient id='borderGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%238b5cf6'/><stop offset='50%' stop-color='%236d28d9'/><stop offset='100%' stop-color='%231e40af'/></linearGradient><linearGradient id='checkGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%23a78bfa'/><stop offset='100%' stop-color='%234f46e5'/></linearGradient><filter id='glow' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceGraphic' stdDeviation='1' result='blur'/><feMerge><feMergeNode in='blur'/><feMergeNode in='SourceGraphic'/></feMerge></filter></defs><circle cx='10' cy='10' r='9' fill='none' stroke='url(%23borderGrad)' stroke-width='1.5' opacity='0.9'/><path d='M6,10 L8.5,12.5 L14,7' stroke='url(%23checkGrad)' stroke-width='2.5' fill='none' stroke-linecap='round' stroke-linejoin='round' filter='url(%23glow)'/></svg>">
</head>
<script>
// –í–†–ï–ú–ï–ù–ù–´–ô –¢–ï–°–¢ - –£–î–ê–õ–ò –ü–û–°–õ–ï –ü–†–û–í–ï–†–ö–ò
console.log('=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê DASHBOARD ===');
console.log('1. DashboardManager:', typeof DashboardManager);
console.log('2. Auth:', typeof Auth);
console.log('3. Notification:', typeof Notification);
console.log('4. appData:', typeof appData);

// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
if (typeof DashboardManager !== 'undefined') {
    console.log('‚úÖ DashboardManager –Ω–∞–π–¥–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º...');
    DashboardManager.init();
} else {
    console.log('‚ùå DashboardManager –ù–ï –ù–ê–ô–î–ï–ù!');
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–æ–≤
    const scripts = document.getElementsByTagName('script');
    console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:');
    for (let script of scripts) {
        console.log(' -', script.src);
    }
}
</script>
<body>
    <nav class="navbar">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <a href="dashboard.html" class="navbar-brand">üéØ IP Expense Manager</a>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <span style="color: white; font-size: 14px;" id="userInfo"></span>
                    <button onclick="Auth.logout()" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); font-size: 14px;">üö™ –í—ã–π—Ç–∏</button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container" style="padding: 30px 20px;">
        <!-- –ó–ê–ì–û–õ–û–í–û–ö –ò –ë–´–°–¢–†–´–ï –î–ï–ô–°–¢–í–ò–Ø -->
        <div class="glass-card" style="padding: 24px; margin-bottom: 24px;">
            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 16px;">
                <div style="flex: 1;">
                    <h1 style="margin-bottom: 8px; color: var(--primary);">üìä –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã</h1>
                    <p style="color: var(--text-light); margin: 0;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞–º–∏ –ò–ü</p>
                </div>
                <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <a href="create-task.html" class="btn btn-primary" id="createTaskBtn">‚ûï –ó–∞–¥–∞—á–∞</a>
                    <a href="tasks.html" class="btn btn-success">üìã –í—Å–µ –∑–∞–¥–∞—á–∏</a>
                    <a href="templates.html" class="btn btn-outline">üéØ –®–∞–±–ª–æ–Ω—ã</a>
                    <a href="history.html" class="quick-action-btn" style="display: none;" id="historyLink">
    <span class="quick-action-icon">üìã</span>
    <span>–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π</span>
</a>
                </div>
            </div>

            <!-- –ö–ê–†–¢–û–ß–ö–ò –°–¢–ê–¢–ò–°–¢–ò–ö–ò -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üè¢</div>
                    <div class="stat-content">
                        <div class="stat-value" id="totalIPs">28</div>
                        <div class="stat-label">–í—Å–µ–≥–æ –ò–ü</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üìã</div>
                    <div class="stat-content">
                        <div class="stat-value" id="activeTasks">0</div>
                        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-content">
                        <div class="stat-value" id="completedToday">0</div>
                        <div class="stat-label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-content">
                        <div class="stat-value" id="monthlyExpenses">0 ‚ÇΩ</div>
                        <div class="stat-label">–†–∞—Å—Ö–æ–¥—ã –∑–∞ –º–µ—Å—è—Ü</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <!-- –ö–ê–õ–ï–ù–î–ê–†–¨ –ò –ë–´–°–¢–†–´–ï –î–ï–ô–°–¢–í–ò–Ø -->
            <div class="dashboard-column">
                <div class="glass-card" style="padding: 24px; margin-bottom: 24px;">
                    <h3 style="margin-bottom: 20px; color: var(--primary);">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∑–∞–¥–∞—á</h3>
                    <div id="taskCalendar"></div>
                </div>

                <div class="glass-card" style="padding: 24px;">
                    <h3 style="margin-bottom: 16px; color: var(--primary);">üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
                    <div class="quick-actions-grid">
                        <a href="create-task.html" class="quick-action-btn" id="quickCreateTask">
                            <span class="quick-action-icon">‚ûï</span>
                            <span>–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</span>
                        </a>
                        <a href="tasks.html" class="quick-action-btn">
                            <span class="quick-action-icon">üìã</span>
                            <span>–í—Å–µ –∑–∞–¥–∞—á–∏</span>
                        </a>
                        <a href="analytics.html" class="quick-action-btn">
                            <span class="quick-action-icon">üìä</span>
                            <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞</span>
                        </a>
                        <a href="expense-items.html" class="quick-action-btn">
                            <span class="quick-action-icon">üóÇÔ∏è</span>
                            <span>–°—Ç–∞—Ç—å–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</span>
                        </a>
                        <a href="cards.html" class="quick-action-btn">
                            <span class="quick-action-icon">üí≥</span>
                            <span>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∞–º–∏</span>
                        </a>
                        <a href="templates.html" class="quick-action-btn">
                            <span class="quick-action-icon">üéØ</span>
                            <span>–®–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞—á</span>
                        </a>
                    </div>
                </div>
            </div>

            <!-- –ü–û–°–õ–ï–î–ù–ò–ï –ó–ê–î–ê–ß–ò –¢–ï–ö–£–©–ï–ì–û –ú–ï–°–Ø–¶–ê -->
            <div class="dashboard-column">
                <div class="glass-card" style="padding: 24px;">
                    <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 16px;">
                        <h3 style="color: var(--primary); margin: 0;">üìù –ó–∞–¥–∞—á–∏ —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—è—Ü–∞</h3>
                        <a href="tasks.html" class="btn btn-outline" style="padding: 8px 16px; font-size: 0.9rem;">–í—Å–µ –∑–∞–¥–∞—á–∏</a>
                    </div>
                    <div id="recentTasks">
                        <div style="text-align: center; color: var(--text-light); padding: 40px;">
                            <div style="font-size: 3rem; margin-bottom: 16px;">üìã</div>
                            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –î–õ–Ø –ö–ê–õ–ï–ù–î–ê–†–Ø -->
    <div id="calendarModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div style="display: flex; justify-content: between; align-items: center; margin-bottom: 20px;">
                <h3 id="modalDateTitle">–ó–∞–¥–∞—á–∏ –Ω–∞ </h3>
                <button onclick="closeCalendarModal()" class="btn btn-outline" style="padding: 8px 12px;">‚úï</button>
            </div>
            <div id="modalTasksList"></div>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/dashboard.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìä –î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            
            Auth.init();
            if (!Auth.requireAuth()) return;
            
            setupRoleBasedUI();
            updateUserInfo();
            
            // ‚úÖ –î–û–ë–ê–í–õ–Ø–ï–ú –≠–¢–£ –°–¢–†–û–ß–ö–£ - –∑–∞–ø—É—Å–∫–∞–µ–º –∫–∞–ª–µ–Ω–¥–∞—Ä—å –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            if (typeof DashboardManager !== 'undefined') {
                DashboardManager.init();
            } else {
                console.error('‚ùå DashboardManager –Ω–µ –Ω–∞–π–¥–µ–Ω');
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
            const historyLink = document.getElementById('historyLink');
            if (historyLink && Auth.isAdmin()) {
                historyLink.style.display = 'flex';
            }
            
            // ‚úÖ –î–û–ë–ê–í–õ–Ø–ï–ú –ö–ù–û–ü–ö–£ –ù–ê–ó–ê–î
            if (typeof NavigationHelper !== 'undefined') {
                NavigationHelper.addBackButton('dashboard.html', '‚Üê –ù–∞–∑–∞–¥');
            }
        });

        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            if (userInfo && Auth.currentUser) {
                userInfo.innerHTML = `üëã ${Auth.currentUser.name} <span style="opacity: 0.8;">(${Auth.currentUser.role === 'admin' ? '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä' : '–£–ø—Ä–∞–≤–ª—è—é—â–∏–π'})</span>`;
            }
        }

        function setupRoleBasedUI() {
            const createTaskBtn = document.getElementById('createTaskBtn');
            const quickCreateTask = document.getElementById('quickCreateTask');
            if (createTaskBtn && quickCreateTask) {
                const display = Auth.isAdmin() ? 'inline-block' : 'none';
                createTaskBtn.style.display = display;
                quickCreateTask.style.display = display;
            }
        }
    </script>
</body>
</html>