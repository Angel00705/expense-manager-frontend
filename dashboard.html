<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä –î–∞—à–±–æ—Ä–¥ - IP Expense Manager</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'><defs><linearGradient id='borderGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%238b5cf6'/><stop offset='50%' stop-color='%236d28d9'/><stop offset='100%' stop-color='%231e40af'/></linearGradient><linearGradient id='checkGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%23a78bfa'/><stop offset='100%' stop-color='%234f46e5'/></linearGradient><filter id='glow' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceGraphic' stdDeviation='1' result='blur'/><feMerge><feMergeNode in='blur'/><feMergeNode in='SourceGraphic'/></feMerge></filter></defs><circle cx='10' cy='10' r='9' fill='none' stroke='url(%23borderGrad)' stroke-width='1.5' opacity='0.9'/><path d='M6,10 L8.5,12.5 L14,7' stroke='url(%23checkGrad)' stroke-width='2.5' fill='none' stroke-linecap='round' stroke-linejoin='round' filter='url(%23glow)'/></svg>">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <a href="dashboard.html" class="navbar-brand">
                    üéØ IP Expense Manager
                </a>
                <div style="display: flex; align-items: center; gap: 20px;">
                    <span style="color: white; font-size: 14px;" id="userInfo">
                        <!-- –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                    </span>
                    <button onclick="Auth.logout()" class="btn" style="background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); font-size: 14px;">
                        üö™ –í—ã–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="container" style="padding: 40px 20px;">
        <div class="glass-card animate-bounce-in" style="padding: 30px; margin-bottom: 30px;">
            <h1 style="margin-bottom: 8px; color: var(--primary);">üìä –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã</h1>
            <p style="color: var(--text-light); margin: 0;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–∞—Å—Ö–æ–¥–∞–º–∏ –ò–ü</p>
        </div>

        <div class="row" style="margin-bottom: 30px;">
            <div class="col-3">
                <div class="glass-card" style="padding: 24px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <div style="color: var(--text-light); margin-bottom: 8px;">–í—Å–µ–≥–æ –ò–ü</div>
                            <div style="font-size: 2rem; font-weight: 700; color: var(--primary);">28</div>
                        </div>
                        <div style="font-size: 2.5rem;">üè¢</div>
                    </div>
                </div>
            </div>

            <div class="col-3">
                <div class="glass-card" style="padding: 24px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <div style="color: var(--text-light); margin-bottom: 8px;">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</div>
                            <div style="font-size: 2rem; font-weight: 700; color: var(--warning);" id="activeTasks">0</div>
                        </div>
                        <div style="font-size: 2.5rem;">üìã</div>
                    </div>
                </div>
            </div>

            <div class="col-3">
                <div class="glass-card" style="padding: 24px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <div style="color: var(--text-light); margin-bottom: 8px;">–í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–µ–≥–æ–¥–Ω—è</div>
                            <div style="font-size: 2rem; font-weight: 700; color: var(--success);" id="completedToday">0</div>
                        </div>
                        <div style="font-size: 2.5rem;">‚úÖ</div>
                    </div>
                </div>
            </div>

            <div class="col-3">
                <div class="glass-card" style="padding: 24px; text-align: center;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <div style="color: var(--text-light); margin-bottom: 8px;">–†–µ–≥–∏–æ–Ω–æ–≤</div>
                            <div style="font-size: 2rem; font-weight: 700; color: var(--secondary);">6</div>
                        </div>
                        <div style="font-size: 2.5rem;">üó∫Ô∏è</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="glass-card" style="padding: 30px; margin-bottom: 30px;">
            <h2 style="margin-bottom: 20px; color: var(--primary);">üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h2>
            <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                <a href="create-task.html" class="btn btn-primary" id="createTaskBtn">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</a>
                <a href="tasks.html" class="btn btn-success">üìã –í—Å–µ –∑–∞–¥–∞—á–∏</a>
                <a href="analytics.html" class="btn btn-warning">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
                <a href="expense-items.html" class="btn btn-outline">üóÇÔ∏è –°—Ç–∞—Ç—å–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</a>
                <a href="cards.html" class="btn btn-outline">üí≥ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∞–º–∏</a>
                <a href="templates.html" class="btn btn-outline">üìã –®–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞—á</a>
            </div>
        </div>

        <div class="glass-card" style="padding: 30px;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; flex-wrap: wrap; gap: 16px;">
                <h2 style="color: var(--primary); margin: 0;">üìù –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–¥–∞—á–∏</h2>
                <a href="tasks.html" class="btn btn-outline">–°–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ</a>
            </div>
            <div id="recentTasks">
                <div style="text-align: center; color: var(--text-light); padding: 40px;">
                    <div style="font-size: 3rem; margin-bottom: 16px;">üìã</div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...</p>
                </div>
            </div>
        </div>
    </main>

    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìä –î–∞—à–±–æ—Ä–¥ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...');
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            Auth.init();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            if (!Auth.requireAuth()) return;
            
            // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ —Ä–æ–ª—è–º
            setupRoleBasedUI();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            updateUserInfo();
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥–∞
            loadDashboardData();
        });

        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            if (userInfo && Auth.currentUser) {
                userInfo.innerHTML = `üëã ${Auth.currentUser.name} 
                    <span style="opacity: 0.8;">(${Auth.currentUser.role === 'admin' ? '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä' : '–£–ø—Ä–∞–≤–ª—è—é—â–∏–π'})</span>`;
            }
        }

        function setupRoleBasedUI() {
            const createTaskBtn = document.getElementById('createTaskBtn');
            if (createTaskBtn) {
                createTaskBtn.style.display = Auth.isAdmin() ? 'block' : 'none';
            }
        }

        function loadDashboardData() {
            const tasks = TaskManager.getUserTasks();
            
            const activeTasks = tasks.filter(task => task.status === 'pending' || task.status === 'in_progress').length;
            const completedToday = tasks.filter(task => {
                if (task.status === 'completed') {
                    const taskDate = new Date(task.updatedAt || task.createdAt);
                    const today = new Date();
                    return taskDate.toDateString() === today.toDateString();
                }
                return false;
            }).length;
            
            document.getElementById('activeTasks').textContent = activeTasks;
            document.getElementById('completedToday').textContent = completedToday;
            
            const recentTasks = tasks.slice(0, 3);
            displayRecentTasks(recentTasks);
        }

        function displayRecentTasks(tasks) {
            const recentTasksContainer = document.getElementById('recentTasks');
            
            if (tasks.length === 0) {
                recentTasksContainer.innerHTML = `
                    <div style="text-align: center; color: var(--text-light); padding: 40px;">
                        <div style="font-size: 3rem; margin-bottom: 16px;">üìã</div>
                        <p>–ù–µ—Ç –∑–∞–¥–∞—á –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è</p>
                        ${Auth.isAdmin() ? '<a href="create-task.html" class="btn btn-primary" style="margin-top: 16px;">‚ûï –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É</a>' : ''}
                    </div>
                `;
                return;
            }
            
            const tasksHtml = tasks.map(task => `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 20px; border-bottom: 1px solid var(--border-light); transition: var(--transition);">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: var(--text-dark); margin-bottom: 4px;">${task.title}</div>
                        <div style="font-size: 0.9rem; color: var(--text-light);">
                            ${task.region} ‚Ä¢ ${FormatHelper.formatDate(task.plannedDate)}
                        </div>
                    </div>
                    <span class="badge ${task.status === 'completed' ? 'badge-success' : task.status === 'in_progress' ? 'badge-warning' : 'badge-info'}">
                        ${TaskManager.statuses[task.status]}
                    </span>
                </div>
            `).join('');
            
            recentTasksContainer.innerHTML = tasksHtml;
        }
    </script>
</body>
</html>