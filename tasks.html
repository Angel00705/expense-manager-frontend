<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ–∏ –∑–∞–¥–∞—á–∏ - Expense Manager</title>
    
    <!-- üé® FAVICON -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'><defs><linearGradient id='borderGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%238b5cf6'/><stop offset='50%' stop-color='%236d28d9'/><stop offset='100%' stop-color='%231e40af'/></linearGradient><linearGradient id='checkGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%23a78bfa'/><stop offset='100%' stop-color='%234f46e5'/></linearGradient><filter id='glow' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceGraphic' stdDeviation='1' result='blur'/><feMerge><feMergeNode in='blur'/><feMergeNode in='SourceGraphic'/></feMerge></filter></defs><circle cx='10' cy='10' r='9' fill='none' stroke='url(%23borderGrad)' stroke-width='1.5' opacity='0.9'/><path d='M6,10 L8.5,12.5 L14,7' stroke='url(%23checkGrad)' stroke-width='2.5' fill='none' stroke-linecap='round' stroke-linejoin='round' filter='url(%23glow)'/></svg>">
    
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/components.css">
    <link rel="stylesheet" href="./css/tasks.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div class="header-left">
                <a href="dashboard.html" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ –¥–∞—à–±–æ—Ä–¥—É</a>
                <div class="logo">üí∞</div>
                <h1>–ú–æ–∏ –∑–∞–¥–∞—á–∏</h1>
            </div>
            <div class="header-right">
                <span class="user-info" id="userInfo"></span>
                <button class="btn-primary" onclick="window.location.href='create-task.html'">+ –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="dashboard-main">
            <div class="page-header">
                <h2>‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏</h2>
                <p>–í—Å–µ –∑–∞–¥–∞—á–∏ –ø–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—é —Ä–∞—Å—Ö–æ–¥–∞–º–∏ –ò–ü</p>
            </div>

            <!-- –§–∏–ª—å—Ç—Ä—ã –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
            <div class="tasks-controls">
                <div class="filter-tabs">
                    <button class="filter-tab active" onclick="filterTasks('all')">–í—Å–µ –∑–∞–¥–∞—á–∏</button>
                    <button class="filter-tab" onclick="filterTasks('pending')">–û–∂–∏–¥–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</button>
                    <button class="filter-tab" onclick="filterTasks('in-progress')">–í —Ä–∞–±–æ—Ç–µ</button>
                    <button class="filter-tab" onclick="filterTasks('completed')">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ</button>
                </div>
                <div class="tasks-stats">
                    <div class="stat-badge total">–í—Å–µ–≥–æ: 12</div>
                    <div class="stat-badge pending">–û–∂–∏–¥–∞—é—Ç: 5</div>
                    <div class="stat-badge in-progress">–í —Ä–∞–±–æ—Ç–µ: 3</div>
                    <div class="stat-badge completed">–ó–∞–≤–µ—Ä—à–µ–Ω–æ: 4</div>
                </div>
            </div>

            <!-- –°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á -->
            <div class="tasks-list" id="tasksList">
                <!-- –ó–∞–¥–∞—á–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </main>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ -->
    <div id="completeTaskModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏</h3>
                <button class="modal-close" onclick="hideCompleteForm()">√ó</button>
            </div>
            <form id="completeTaskForm" class="modal-form">
                <div class="task-info">
                    <h4 id="modalTaskTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–¥–∞—á–∏</h4>
                    <p id="modalTaskDescription">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏...</p>
                </div>
                
                <div class="form-section">
                    <h4>üìä –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ</h4>
                    <div class="form-row">
                        <div class="input-group">
                            <label>–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å—É–º–º–∞ *</label>
                            <input type="number" id="actualAmount" class="form-input" required>
                        </div>
                        <div class="input-group">
                            <label>–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–∞—Ç–∞ *</label>
                            <input type="date" id="actualDate" class="form-input" required>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é</label>
                        <textarea id="completionComment" class="form-textarea" placeholder="–û–ø–∏—à–∏—Ç–µ –¥–µ—Ç–∞–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è..."></textarea>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="hideCompleteForm()">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-primary">–ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á
        const tasks = [
            {
                id: 1,
                title: '–û–ø–ª–∞—Ç–∞ –∞—Ä–µ–Ω–¥—ã –ø–æ–º–µ—â–µ–Ω–∏—è',
                ip: '–ò–ü "–í–æ—Å—Ç–æ–∫"',
                manager: '–ò–≤–∞–Ω–æ–≤ –ê.–°.',
                expenseItem: '–ê—Ä–µ–Ω–¥–∞ –ø–æ–º–µ—â–µ–Ω–∏—è',
                plannedAmount: '50,000 ‚ÇΩ',
                plannedDate: '2025-01-15',
                actualAmount: '',
                actualDate: '',
                status: 'pending',
                description: '–ï–∂–µ–º–µ—Å—è—á–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –∞—Ä–µ–Ω–¥—ã –æ—Ñ–∏—Å–Ω–æ–≥–æ –ø–æ–º–µ—â–µ–Ω–∏—è',
                comment: '–û–ø–ª–∞—Ç–∏—Ç—å –¥–æ 15 —á–∏—Å–ª–∞'
            },
            {
                id: 2,
                title: '–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',
                ip: '–ò–ü "–°–µ–≤–µ—Ä"',
                manager: '–ü–µ—Ç—Ä–æ–≤–∞ –ú.–ò.',
                expenseItem: '–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏',
                plannedAmount: '15,000 ‚ÇΩ',
                plannedDate: '2025-01-10',
                actualAmount: '14,800 ‚ÇΩ',
                actualDate: '2025-01-08',
                status: 'completed',
                description: '–û–ø–ª–∞—Ç–∞ —ç–ª–µ–∫—Ç—Ä–æ—ç–Ω–µ—Ä–≥–∏–∏, –≤–æ–¥—ã, –æ—Ç–æ–ø–ª–µ–Ω–∏—è',
                comment: '–ö–≤–∏—Ç–∞–Ω—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–∏—Ç—å –∫ –æ—Ç—á—ë—Ç—É'
            },
            {
                id: 3,
                title: '–ó–∞–∫—É–ø–∫–∞ –∫–∞–Ω—Ü—Ç–æ–≤–∞—Ä–æ–≤',
                ip: '–ò–ü "–Æ–≥"',
                manager: '–°–∏–¥–æ—Ä–æ–≤ –í.–ü.',
                expenseItem: '–•–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã',
                plannedAmount: '5,000 ‚ÇΩ',
                plannedDate: '2025-01-20',
                actualAmount: '',
                actualDate: '',
                status: 'in-progress',
                description: '–ó–∞–∫—É–ø–∫–∞ –∫–∞–Ω—Ü–µ–ª—è—Ä—Å–∫–∏—Ö –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç–µ–π –Ω–∞ –æ—Ñ–∏—Å',
                comment: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ —á–µ–∫–∏'
            }
        ];

        let currentTaskId = null;

        function loadTasks(filter = 'all') {
            const tasksList = document.getElementById('tasksList');
            const filteredTasks = filter === 'all' ? tasks : tasks.filter(task => task.status === filter);
            
            tasksList.innerHTML = filteredTasks.map(task => `
                <div class="task-item task-${task.status}">
                    <div class="task-header">
                        <div class="task-title">
                            <h3>${task.title}</h3>
                            <span class="task-status status-${task.status}">
                                ${getStatusText(task.status)}
                            </span>
                        </div>
                        <div class="task-amount">
                            <span class="planned">${task.plannedAmount}</span>
                            ${task.actualAmount ? `<span class="actual">${task.actualAmount}</span>` : ''}
                        </div>
                    </div>
                    
                    <div class="task-details">
                        <div class="task-info">
                            <div class="info-item">
                                <span class="label">–ò–ü:</span>
                                <span class="value">${task.ip}</span>
                            </div>
                            <div class="info-item">
                                <span class="label">–°—Ç–∞—Ç—å—è:</span>
                                <span class="value">${task.expenseItem}</span>
                            </div>
                            <div class="info-item">
                                <span class="label">–°—Ä–æ–∫:</span>
                                <span class="value">${formatDate(task.plannedDate)}</span>
                            </div>
                            ${task.actualDate ? `
                            <div class="info-item">
                                <span class="label">–í—ã–ø–æ–ª–Ω–µ–Ω–æ:</span>
                                <span class="value">${formatDate(task.actualDate)}</span>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="task-description">
                            <p>${task.description}</p>
                            ${task.comment ? `<p class="task-comment">üí° ${task.comment}</p>` : ''}
                        </div>
                    </div>
                    
                    <div class="task-actions">
                        ${task.status === 'pending' ? `
                            <button class="btn-primary btn-sm" onclick="startTask(${task.id})">‚ñ∂Ô∏è –ù–∞—á–∞—Ç—å</button>
                        ` : ''}
                        ${task.status === 'in-progress' ? `
                            <button class="btn-primary btn-sm" onclick="completeTask(${task.id})">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
                        ` : ''}
                        ${task.status === 'completed' ? `
                            <button class="btn-secondary btn-sm" onclick="viewTask(${task.id})">üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function getStatusText(status) {
            const statuses = {
                'pending': '–û–∂–∏–¥–∞–µ—Ç',
                'in-progress': '–í —Ä–∞–±–æ—Ç–µ',
                'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω–æ'
            };
            return statuses[status] || status;
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('ru-RU');
        }

        function filterTasks(filter) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            loadTasks(filter);
        }

        function startTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            task.status = 'in-progress';
            loadTasks();
            alert('–ó–∞–¥–∞—á–∞ –Ω–∞—á–∞—Ç–∞!');
        }

        function completeTask(taskId) {
            currentTaskId = taskId;
            const task = tasks.find(t => t.id === taskId);
            
            document.getElementById('modalTaskTitle').textContent = task.title;
            document.getElementById('modalTaskDescription').textContent = task.description;
            document.getElementById('actualAmount').value = '';
            document.getElementById('actualDate').value = '';
            document.getElementById('completionComment').value = '';
            
            document.getElementById('completeTaskModal').style.display = 'flex';
        }

        function hideCompleteForm() {
            document.getElementById('completeTaskModal').style.display = 'none';
        }

        function viewTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            alert(`–ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–¥–∞—á–∏: ${task.title}\n–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å—É–º–º–∞: ${task.actualAmount}\n–î–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${formatDate(task.actualDate)}`);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('auth_token');
            const userEmail = localStorage.getItem('user_email');
            
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            document.getElementById('userInfo').textContent = userEmail;
            loadTasks();

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
            document.getElementById('completeTaskForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const actualAmount = document.getElementById('actualAmount').value;
                const actualDate = document.getElementById('actualDate').value;
                const comment = document.getElementById('completionComment').value;

                if (!actualAmount || !actualDate) {
                    alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è');
                    return;
                }

                const task = tasks.find(t => t.id === currentTaskId);
                task.actualAmount = `${parseInt(actualAmount).toLocaleString()} ‚ÇΩ`;
                task.actualDate = actualDate;
                task.status = 'completed';
                
                if (comment) {
                    task.completionComment = comment;
                }

                hideCompleteForm();
                loadTasks();
                alert('–ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!');
            });
        });
    </script>
</body>
</html>