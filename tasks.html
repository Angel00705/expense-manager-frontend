<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìã –ó–∞–¥–∞—á–∏ - IP Expense Manager</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- üé® FAVICON -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'><defs><linearGradient id='borderGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%238b5cf6'/><stop offset='50%' stop-color='%236d28d9'/><stop offset='100%' stop-color='%231e40af'/></linearGradient><linearGradient id='checkGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%23a78bfa'/><stop offset='100%' stop-color='%234f46e5'/></linearGradient><filter id='glow' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceGraphic' stdDeviation='1' result='blur'/><feMerge><feMergeNode in='blur'/><feMergeNode in='SourceGraphic'/></feMerge></filter></defs><circle cx='10' cy='10' r='9' fill='none' stroke='url(%23borderGrad)' stroke-width='1.5' opacity='0.9'/><path d='M6,10 L8.5,12.5 L14,7' stroke='url(%23checkGrad)' stroke-width='2.5' fill='none' stroke-linecap='round' stroke-linejoin='round' filter='url(%23glow)'/></svg>">
    <!-- üîß –ü–û–î–ö–õ–Æ–ß–ê–ï–ú –£–¢–ò–õ–ò–¢–´ -->
    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
</head>
<body>
    <!-- üéØ –•–ï–î–ï–† -->
    <header class="header">
        <nav class="nav">
            <div class="logo">
                <span>üí∞</span>
                IP Expense Manager
            </div>
            <div class="nav-links">
                <a href="dashboard.html" class="nav-link">üìä –î–∞—à–±–æ—Ä–¥</a>
                <a href="create-task.html" class="nav-link">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</a>
                <a href="tasks.html" class="nav-link active">üìã –ó–∞–¥–∞—á–∏</a>
                <a href="expense-items.html" class="nav-link">üóÇÔ∏è –°—Ç–∞—Ç—å–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</a>
                <a href="cards.html" class="nav-link">üí≥ –ö–∞—Ä—Ç—ã</a>
                <div class="user-info">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
                </div>
                <button class="btn btn-outline" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
            </div>
        </nav>
    </header>

    <main class="container">
        <!-- üé™ –ó–ê–ì–û–õ–û–í–û–ö –ò –§–ò–õ–¨–¢–†–´ -->
        <div class="glass-card">
            <div class="flex items-center justify-between mb-6" style="flex-wrap: wrap; gap: 16px;">
                <div>
                    <h1 style="margin-bottom: 8px;">üìã –í—Å–µ –∑–∞–¥–∞—á–∏</h1>
                    <p class="text-muted">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á</p>
                </div>
                <div class="flex gap-4" style="flex-wrap: wrap;">
                    <a href="create-task.html" class="btn btn-primary">‚ûï –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</a>
                </div>
            </div>

            <!-- üîç –§–ò–õ–¨–¢–†–´ -->
            <div class="flex gap-4 mb-6" style="flex-wrap: wrap;">
                <div class="form-group" style="flex: 1; min-width: 150px;">
                    <select class="form-select" id="statusFilter" onchange="filterTasks()">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        ${Object.entries(appData.taskStatuses).map(([key, value]) => 
                            `<option value="${key}">${value}</option>`
                        ).join('')}
                    </select>
                </div>
                <div class="form-group" style="flex: 1; min-width: 150px;">
                    <select class="form-select" id="regionFilter" onchange="filterTasks()">
                        <option value="">–í—Å–µ —Ä–µ–≥–∏–æ–Ω—ã</option>
                        ${appData.regions.map(region => 
                            `<option value="${region}">${region}</option>`
                        ).join('')}
                    </select>
                </div>
                <div class="form-group" style="flex: 1; min-width: 200px;">
                    <input type="text" class="form-input" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é..." onkeyup="filterTasks()">
                </div>
            </div>
        </div>

        <!-- üìä –°–ü–ò–°–û–ö –ó–ê–î–ê–ß -->
        <div class="glass-card animate-fade-in">
            <div id="tasksList">
                <div class="text-center text-muted" style="padding: 60px;">
                    <div style="font-size: 4rem; margin-bottom: 16px;">üìã</div>
                    <h3 style="margin-bottom: 8px;">–ó–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                    <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
                    <a href="create-task.html" class="btn btn-primary mt-4">‚ûï –°–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤—É—é –∑–∞–¥–∞—á—É</a>
                </div>
            </div>
        </div>
    </main>

    <script>
        let allTasks = [];

        function logout() {
            localStorage.removeItem('currentUser');
            appData.currentUser = null;
            showNotification('üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!', 'info');
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 1000);
        }

        function loadTasks() {
            // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            allTasks = [
                {
                    id: 1,
                    title: '–ó–∞–∫—É–ø–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è –æ—Ñ–∏—Å–∞',
                    region: '–ê—Å—Ç—Ä–∞—Ö–∞–Ω—å',
                    ip: '–ò–ü –ö—Ä—É—Ç–æ—É—Å–æ–≤',
                    expenseItem: 'üõí –ü—Ä–æ–¥—É–∫—Ç—ã',
                    responsibleManager: '–ö—Å–µ–Ω–∏—è –ë.',
                    plannedAmount: 5000,
                    status: 'pending',
                    plannedDate: '2024-01-20',
                    bankCard: '*3420',
                    description: '–ö–æ—Ñ–µ, —á–∞–π, —Å–∞—Ö–∞—Ä, –ø–µ—á–µ–Ω—å–µ, –≤–æ–¥–∞'
                },
                {
                    id: 2,
                    title: '–û–ø–ª–∞—Ç–∞ –∞—Ä–µ–Ω–¥—ã –æ—Ñ–∏—Å–∞',
                    region: '–ö—É—Ä–≥–∞–Ω',
                    ip: '–ò–ü –ë–æ–Ω–¥–∞—Ä–µ–Ω–∫–æ –õ.–ò.',
                    expenseItem: 'üè¢ –ê–†–ï–ù–î–ê –û–§–ò–°–´',
                    responsibleManager: '–ï–≤–≥–µ–Ω–∏—è –ì.',
                    plannedAmount: 15000,
                    status: 'completed',
                    plannedDate: '2024-01-15',
                    bankCard: '*7254',
                    description: '–ê—Ä–µ–Ω–¥–∞ –∑–∞ —è–Ω–≤–∞—Ä—å 2024 –≥–æ–¥–∞'
                },
                {
                    id: 3,
                    title: '–ó–∞–ø—Ä–∞–≤–∫–∞ —Å–ª—É–∂–µ–±–Ω–æ–≥–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è',
                    region: '–ë—É—Ä—è—Ç–∏—è',
                    ip: '–ò–ü –ê—Å—Ç–∞–Ω–æ–≤–∏ –ê—Ä–∞–∑',
                    expenseItem: '‚õΩ –ê–ó–°',
                    responsibleManager: '–ö—Å–µ–Ω–∏—è –ë.',
                    plannedAmount: 3000,
                    status: 'in_progress',
                    plannedDate: '2024-01-18',
                    bankCard: '*7651',
                    description: '–ü–æ–ª–Ω—ã–π –±–∞–∫ 95-–π –±–µ–Ω–∑–∏–Ω'
                }
            ];
            
            filterTasks();
        }

        function filterTasks() {
            const statusFilter = document.getElementById('statusFilter').value;
            const regionFilter = document.getElementById('regionFilter').value;
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();
            
            let filteredTasks = allTasks.filter(task => {
                const matchesStatus = !statusFilter || task.status === statusFilter;
                const matchesRegion = !regionFilter || task.region === regionFilter;
                const matchesSearch = !searchQuery || 
                    task.title.toLowerCase().includes(searchQuery) ||
                    task.description.toLowerCase().includes(searchQuery);
                
                return matchesStatus && matchesRegion && matchesSearch;
            });
            
            displayTasks(filteredTasks);
        }

        function displayTasks(tasks) {
            const tasksList = document.getElementById('tasksList');
            
            if (tasks.length === 0) {
                tasksList.innerHTML = `
                    <div class="text-center text-muted" style="padding: 60px;">
                        <div style="font-size: 4rem; margin-bottom: 16px;">üîç</div>
                        <h3 style="margin-bottom: 8px;">–ó–∞–¥–∞—á–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏</p>
                    </div>
                `;
                return;
            }
            
            tasksList.innerHTML = tasks.map(task => `
                <div class="task-card glass-card mb-4" style="border-left: 4px solid ${
                    task.status === 'completed' ? '#10b981' : 
                    task.status === 'in_progress' ? '#f59e0b' : '#8b5cf6'
                };">
                    <div class="flex items-start justify-between mb-4" style="flex-wrap: wrap; gap: 16px;">
                        <div style="flex: 1; min-width: 300px;">
                            <h3 style="margin-bottom: 8px; color: var(--text-dark);">${task.title}</h3>
                            <div class="flex gap-4 mb-2" style="flex-wrap: wrap;">
                                <span class="badge ${task.status === 'completed' ? 'badge-success' : task.status === 'in_progress' ? 'badge-warning' : 'badge-info'}">
                                    ${appData.taskStatuses[task.status]}
                                </span>
                                <span class="badge badge-info">${task.region}</span>
                                <span class="badge" style="background: rgba(139, 92, 246, 0.1); color: var(--primary);">
                                    ${task.expenseItem}
                                </span>
                            </div>
                            <div class="text-muted" style="font-size: 0.9rem;">
                                <div>üíº ${task.ip} ‚Ä¢ üë§ ${task.responsibleManager}</div>
                                <div>üí≥ –ö–∞—Ä—Ç–∞: ${task.bankCard} ‚Ä¢ üìÖ ${formatDate(task.plannedDate)}</div>
                                ${task.description ? `<div style="margin-top: 8px;">üìù ${task.description}</div>` : ''}
                            </div>
                        </div>
                        
                        <div class="text-right">
                            <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary); margin-bottom: 8px;">
                                ${formatCurrency(task.plannedAmount)}
                            </div>
                            <div class="flex gap-2" style="flex-wrap: wrap;">
                                ${isAdmin() ? `
                                    <button class="btn btn-outline" style="padding: 8px 12px;" onclick="editTask(${task.id})">
                                        ‚úèÔ∏è
                                    </button>
                                    <button class="btn btn-outline" style="padding: 8px 12px; background: rgba(239, 68, 68, 0.1); color: var(--error);" onclick="deleteTask(${task.id})">
                                        üóëÔ∏è
                                    </button>
                                ` : ''}
                                ${isManager() && task.status !== 'completed' ? `
                                    <button class="btn btn-success" style="padding: 8px 16px;" onclick="completeTask(${task.id})">
                                        ‚úÖ –í—ã–ø–æ–ª–Ω–∏—Ç—å
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function editTask(taskId) {
            if (!checkAdminAccess()) return;
            
            const task = allTasks.find(t => t.id === taskId);
            if (task) {
                showNotification(`‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏: ${task.title}`, 'info');
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –æ—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            }
        }

        function deleteTask(taskId) {
            if (!checkAdminAccess()) return;
            
            const task = allTasks.find(t => t.id === taskId);
            if (task && confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É "${task.title}"?`)) {
                allTasks = allTasks.filter(t => t.id !== taskId);
                filterTasks();
                showNotification('üóëÔ∏è –ó–∞–¥–∞—á–∞ —É–¥–∞–ª–µ–Ω–∞', 'success');
            }
        }

        function completeTask(taskId) {
            const task = allTasks.find(t => t.id === taskId);
            if (task) {
                task.status = 'completed';
                filterTasks();
                showNotification('‚úÖ –ó–∞–¥–∞—á–∞ –æ—Ç–º–µ—á–µ–Ω–∞ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è', 'success');
            }
        }

        // üîß –ò–ù–ò–¶–ò–ê–õ–ò–ó–ò–†–£–ï–ú –ü–†–ò–õ–û–ñ–ï–ù–ò–ï –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            if (!appData.currentUser) {
                window.location.href = 'login.html';
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞—á–∏
            loadTasks();
        });
    </script>
</body>
</html>