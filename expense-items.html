<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üóÇÔ∏è –°—Ç–∞—Ç—å–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ - IP Expense Manager</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- üé® FAVICON -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'><defs><linearGradient id='borderGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%238b5cf6'/><stop offset='50%' stop-color='%236d28d9'/><stop offset='100%' stop-color='%231e40af'/></linearGradient><linearGradient id='checkGrad' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' stop-color='%23a78bfa'/><stop offset='100%' stop-color='%234f46e5'/></linearGradient><filter id='glow' x='-50%' y='-50%' width='200%' height='200%'><feGaussianBlur in='SourceGraphic' stdDeviation='1' result='blur'/><feMerge><feMergeNode in='blur'/><feMergeNode in='SourceGraphic'/></feMerge></filter></defs><circle cx='10' cy='10' r='9' fill='none' stroke='url(%23borderGrad)' stroke-width='1.5' opacity='0.9'/><path d='M6,10 L8.5,12.5 L14,7' stroke='url(%23checkGrad)' stroke-width='2.5' fill='none' stroke-linecap='round' stroke-linejoin='round' filter='url(%23glow)'/></svg>">
    <!-- üîß –ü–û–î–ö–õ–Æ–ß–ê–ï–ú –£–¢–ò–õ–ò–¢–´ -->
    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
</head>
<body>
    <!-- üéØ –•–ï–î–ï–† -->
    <header class="header">
        <nav class="nav">
            <div class="logo">
                <span>üí∞</span>
                IP Expense Manager
            </div>
            <div class="nav-links">
                <a href="dashboard.html" class="nav-link">üìä –î–∞—à–±–æ—Ä–¥</a>
                <a href="create-task.html" class="nav-link">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É</a>
                <a href="tasks.html" class="nav-link">üìã –ó–∞–¥–∞—á–∏</a>
                <a href="expense-items.html" class="nav-link active">üóÇÔ∏è –°—Ç–∞—Ç—å–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</a>
                <a href="cards.html" class="nav-link">üí≥ –ö–∞—Ä—Ç—ã</a>
                <div class="user-info">
                    <!-- –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ —á–µ—Ä–µ–∑ JavaScript -->
                </div>
                <button class="btn btn-outline" onclick="logout()">üö™ –í—ã–π—Ç–∏</button>
            </div>
        </nav>
    </header>

    <main class="container">
        <div class="glass-card animate-slide-in">
            <div class="flex items-center justify-between mb-6" style="flex-wrap: wrap; gap: 16px;">
                <div>
                    <h1 style="margin-bottom: 8px;">üóÇÔ∏è –°—Ç–∞—Ç—å–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</h1>
                    <p class="text-muted">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö</p>
                </div>
                ${isAdmin() ? `
                    <button class="btn btn-primary" onclick="showAddForm()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å—Ç–∞—Ç—å—é</button>
                ` : ''}
            </div>

            <!-- üìä –¢–ê–ë–õ–ò–¶–ê –°–¢–ê–¢–ï–ô –†–ê–°–•–û–î–û–í -->
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th>–°—Ç–∞—Ç—å—è —Ä–∞—Å—Ö–æ–¥–æ–≤</th>
                            <th>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π</th>
                            <th>–ö–æ–ª-–≤–æ –∑–∞–¥–∞—á</th>
                            ${isAdmin() ? '<th>–î–µ–π—Å—Ç–≤–∏—è</th>' : ''}
                        </tr>
                    </thead>
                    <tbody id="expenseItemsTable">
                        <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ‚ú® –§–û–†–ú–ê –î–û–ë–ê–í–õ–ï–ù–ò–Ø/–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤) -->
        ${isAdmin() ? `
        <div class="glass-card mt-6 animate-fade-in" id="expenseForm" style="display: none;">
            <h3 style="margin-bottom: 20px;" id="formTitle">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é —Ä–∞—Å—Ö–æ–¥–æ–≤</h3>
            
            <form id="expenseItemForm">
                <div class="flex gap-4 mb-6" style="flex-wrap: wrap;">
                    <div class="form-group" style="flex: 1; min-width: 200px;">
                        <label class="form-label">üè∑Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—å–∏ *</label>
                        <input type="text" class="form-input" id="expenseItemName" required 
                               placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: üõí –ü—Ä–æ–¥—É–∫—Ç—ã">
                    </div>
                    
                    <div class="form-group" style="flex: 1; min-width: 200px;">
                        <label class="form-label">üë§ –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π *</label>
                        <select class="form-select" id="expenseItemManager" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ...</option>
                            <option value="–ö—Å–µ–Ω–∏—è –ë.">–ö—Å–µ–Ω–∏—è –ë.</option>
                            <option value="–ü–æ–ª–∏–Ω–∞ –ú.">–ü–æ–ª–∏–Ω–∞ –ú.</option>
                            <option value="–ò–≤–∞–Ω –í.">–ò–≤–∞–Ω –í.</option>
                            <option value="–ò–Ω–Ω–∞ –ë.">–ò–Ω–Ω–∞ –ë.</option>
                            <option value="–ê–ª–µ—Å—è –ë.">–ê–ª–µ—Å—è –ë.</option>
                            <option value="–ï–≤–≥–µ–Ω–∏—è –ì.">–ï–≤–≥–µ–Ω–∏—è –ì.</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex gap-4">
                    <button type="submit" class="btn btn-primary" id="submitButton">
                        üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                    <button type="button" class="btn btn-outline" onclick="hideForm()">
                        ‚ùå –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </form>
        </div>
        ` : ''}
    </main>

    <script>
        let editingItemId = null;

        function logout() {
            localStorage.removeItem('currentUser');
            appData.currentUser = null;
            showNotification('üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!', 'info');
            setTimeout(() => {
                window.location.href = 'login.html';
            }, 1000);
        }

        function loadExpenseItems() {
            const tableBody = document.getElementById('expenseItemsTable');
            
            const itemsWithStats = appData.expenseItems.map(item => {
                return {
                    name: item,
                    manager: appData.managers[item] || '–ù–µ –Ω–∞–∑–Ω–∞—á–µ–Ω',
                    taskCount: Math.floor(Math.random() * 10) // –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
                };
            });
            
            tableBody.innerHTML = itemsWithStats.map((item, index) => `
                <tr>
                    <td>
                        <div style="font-weight: 600;">${item.name}</div>
                    </td>
                    <td>
                        <span class="badge badge-info">${item.manager}</span>
                    </td>
                    <td>
                        <span style="font-weight: 600; color: var(--primary);">${item.taskCount}</span>
                    </td>
                    ${isAdmin() ? `
                    <td>
                        <div class="flex gap-2">
                            <button class="btn btn-outline" style="padding: 6px 10px;" 
                                    onclick="editExpenseItem(${index}, '${item.name}', '${item.manager}')">
                                ‚úèÔ∏è
                            </button>
                            <button class="btn btn-outline" style="padding: 6px 10px; background: rgba(239, 68, 68, 0.1); color: var(--error);" 
                                    onclick="deleteExpenseItem(${index}, '${item.name}')">
                                üóëÔ∏è
                            </button>
                        </div>
                    </td>
                    ` : ''}
                </tr>
            `).join('');
        }

        function showAddForm() {
            if (!checkAdminAccess()) return;
            
            document.getElementById('expenseForm').style.display = 'block';
            document.getElementById('formTitle').textContent = '‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é —Å—Ç–∞—Ç—å—é —Ä–∞—Å—Ö–æ–¥–æ–≤';
            document.getElementById('submitButton').textContent = 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å';
            editingItemId = null;
            clearForm('expenseItemForm');
        }

        function hideForm() {
            document.getElementById('expenseForm').style.display = 'none';
            editingItemId = null;
        }

        function editExpenseItem(id, name, manager) {
            if (!checkAdminAccess()) return;
            
            document.getElementById('expenseForm').style.display = 'block';
            document.getElementById('formTitle').textContent = '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ç—å—é —Ä–∞—Å—Ö–æ–¥–æ–≤';
            document.getElementById('submitButton').textContent = 'üíæ –û–±–Ω–æ–≤–∏—Ç—å';
            
            document.getElementById('expenseItemName').value = name;
            document.getElementById('expenseItemManager').value = manager;
            editingItemId = id;
        }

        function deleteExpenseItem(id, name) {
            if (!checkAdminAccess()) return;
            
            if (confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ç—å—é —Ä–∞—Å—Ö–æ–¥–æ–≤ "${name}"?`)) {
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–µ–Ω–¥–∞
                showNotification(`üóëÔ∏è –°—Ç–∞—Ç—å—è "${name}" —É–¥–∞–ª–µ–Ω–∞`, 'success');
                loadExpenseItems(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã
        document.getElementById('expenseItemForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!checkAdminAccess()) return;
            
            const formData = {
                name: document.getElementById('expenseItemName').value,
                manager: document.getElementById('expenseItemManager').value
            };
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            const errors = validateForm(formData, ['name', 'manager']);
            if (errors.length > 0) {
                errors.forEach(error => showNotification(error, 'error'));
                return;
            }
            
            if (editingItemId === null) {
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Å—Ç–∞—Ç—å–∏
                showNotification(`‚úÖ –°—Ç–∞—Ç—å—è "${formData.name}" –¥–æ–±–∞–≤–ª–µ–Ω–∞`, 'success');
            } else {
                // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π
                showNotification(`‚úÖ –°—Ç–∞—Ç—å—è "${formData.name}" –æ–±–Ω–æ–≤–ª–µ–Ω–∞`, 'success');
            }
            
            hideForm();
            loadExpenseItems();
        });

        // üîß –ò–ù–ò–¶–ò–ê–õ–ò–ó–ò–†–£–ï–ú –ü–†–ò–õ–û–ñ–ï–ù–ò–ï –ü–†–ò –ó–ê–ì–†–£–ó–ö–ï –°–¢–†–ê–ù–ò–¶–´
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
            if (!appData.currentUser) {
                window.location.href = 'login.html';
                return;
            }
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç–∞—Ç—å–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤
            loadExpenseItems();
        });
    </script>
</body>
</html>